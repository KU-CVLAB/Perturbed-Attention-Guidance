<!DOCTYPE html>
<html>

<head lang="en">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TJVB2EXLGC"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-TJVB2EXLGC');
    </script>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <title>Perturbed-Attention Guidance</title>

    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- <meta property="og:image" content="img/cats.png"> -->
    <!-- <meta property="og:image:type" content="image/png"> -->
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ku-cvlab.github.io/Perturbed-Attention-Guidance/">
    <meta property="og:title" content="Self-Rectifying Diffusion Sampling with Perturbed-Attention Guidance">
    <meta property="og:description" content="">

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/codemirror.min.css">
    <link rel="stylesheet" href="css/app.css">

    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/codemirror.min.js"></script>
    <script src="js/clipboard.min.js"></script>
    <script src="js/video_comparison.js"></script>
    <script src="js/app.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style type="text/css">
        img-comparison-slider {
          --divider-width: 2px;
          --divider-color: #ffffff;
          --divider-shadow: 0px 0px 5px hsl(0, 0%, 17%);
          --default-handle-width: 100px;
          --default-handle-opacity: 1.0;
          --default-handle-shadow: 0px 0px 5px hsl(0, 0%, 17%);
        }
      </style>
</head>

<!-- Image Comparison Slider -->
<!-- https://github.com/sneas/img-comparison-slider -->
<script defer src="https://cdn.jsdelivr.net/npm/img-comparison-slider@8/dist/index.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/img-comparison-slider@8/dist/styles.css" />

<body>
    <div style="margin-left:5%; margin-right:5%">
        <div class="container" id="header" style="text-align: center; margin: auto;">
            <div class="row" id="title-row" style="max-width: 100%; margin: 10 auto; display: inline-block">
                <h1 class="col-md-12 text-center" style="margin-top: 70px;" id="title">
                    Self-Rectifying Diffusion Sampling <br>with Perturbed-Attention Guidance
                    <!-- <small>
                    Arxiv 2024
                </small> -->
                </h1>
            </div>
            <div class="row" id="author-row" style="margin:0 auto;">
                <div class="col-md-12 text-center" style="display: table; margin:0 auto;">
                    <a style="text-decoration:none" href="https://github.com/sunovivid">
                        Donghoon&nbsp;Ahn
                    </a>
                    <span style="padding-left: 20px;"></span>
<!--                     <a style="text-decoration:none" href="https://github.com/HyoungwonCho">
                        Hyoungwon&nbsp;Cho<sup>*1</sup>
                    </a> -->
<!--                     <span style="padding-left: 20px;"></span> -->
                    <a style="text-decoration:none" href="https://github.com/Min-Jaewon">
                        Jaewon&nbsp;Min
                    </a>
                    <span style="padding-left: 20px;"></span>
<!--                     <a style="text-decoration:none" href="https://scholar.google.com/citations?user=7cyLEQ0AAAAJ&hl=ko&oi=sra">
                        Wooseok&nbsp;Jang<sup>1</sup>
                    </a>
                    <span style="padding-left: 20px;"></span> -->
                    <a style="text-decoration:none" href="https://github.com/kmjnwn">
                        Jungwoo&nbsp;Kim
                    </a>
<!--                     <br> -->
<!--                     <span style="padding-left: 20px;"></span> -->
<!--                     <a style="text-decoration:none" href="https://github.com/shhh0620">
                        SeonHwa&nbsp;Kim<sup>1</sup>
                    </a>
                    <span style="padding-left: 20px;"></span> -->
                    <!-- <a style="text-decoration:none" href="https://cvlab.korea.ac.kr"> -->
<!--                         Hyun&nbsp;Hee&nbsp;Park<sup>2</sup> -->
                    <!-- </a> -->
<!--                     <span style="padding-left: 20px;"></span>
                    <a style="text-decoration:none" href="https://ipa.korea.ac.kr">
                        Kyong&nbsp;Hwan&nbsp;Jin<sup>1&dagger;</sup>
                    </a> -->
                    <span style="padding-left: 20px;"></span>
                    <a style="text-decoration:none" href="https://cvlab.korea.ac.kr">
                        Seungryong&nbsp;Kim
                    </a>
                    <br>
<!--                     <small>
                        *&nbsp; Equal Contribution
                        <span style="padding-left: 20px;"></span>
                        &dagger;&nbsp; Co-corresponding author
                    </small> -->
                    <table class="author-table" id="author-table">
                        <td>
                            <br>
                            <sup>1</sup>&nbsp;
                            Korea University
                        </td>
<!--                         <td>
                            <br>
                            <sup>2</sup>&nbsp;
                            Samsung Electronics
                        </td> -->
                    </table>

                </div>
            </div>
        </div>

        <br/>
        
        <script>
            document.getElementById('author-row').style.maxWidth = document.getElementById("-row").clientWidth + 'px';
        </script>

        <div class="container" id="main">
            <div class="row">
                <div class="col-sm-6 col-sm-offset-3 text-center">
                    <ul class="nav nav-pills nav-justified">
<!--                         <li>
                            <a href="https://arxiv.org/abs/2403.17377">
                            <img src="./img/paper_image.png" height="60px">
                            <h4><strong>Paper</strong></h4>
                            </a>
                        </li> -->
<!--                         <li>
                            <a href="https://github.com/KU-CVLAB/Perturbed-Attention-Guidance" target="_blank">
                                <image src="img/github.png" height="60px">
                                    <h4><strong>Code</strong></h4>
                            </a>
                        </li>
                        <li>
                            <a href="https://huggingface.co/hyoungwoncho/sd_perturbed_attention_guidance" target="_blank">
                                <image src="img/diffusers.png" height="60px">
                                    <h4><strong>SD Pipeline</strong></h4>
                            </a>
                        </li> -->
                        <li>
                            <a href="https://huggingface.co/spaces/multimodalart/perturbed-attention-guidance-sdxl" target="_blank">
                                <image src="img/hf-logo.png" height="60px">
                                    <h4><strong>SDXL Demo</strong></h4>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- <div class="container"> -->
            <div class="row">
                <div class="text-center">
                    <img src="./img/projectpage_teasesr_small.PNG"
                        style="width: 94%; margin-top: 2%; padding-right: 3%; margin-bottom: -0.5%;" width="100%">
                </div>
                <div style="text-align:justify;  margin-left:6%; margin-right:6%; margin-bottom: 50px;">
                    <strong>Qualitative comparisons between unguided (baseline) and perturbed-attention-guided (PAG)
                        diffusion samples.</strong>
                    Without any <strong><i>external conditions</i></strong>, <i>e.g.</i>, class labels or text prompts,
                    or <strong><i>additional training</i></strong>,
                    our <strong>PAG</strong> dramatically elevates the quality of diffusion samples even in
                    unconditional generation,
                    where classifier-free guidance (CFG) is inapplicable. Our guidance can also enhance the baseline
                    performance in various downstream tasks such as ControlNet with empty prompt
                    and image restoration such as inpainting and deblurring.
                </div>
            </div>

            <div class="row">
                <div class="text-center col-md-offset-0">
                    <h2>
                        Abstract
                    </h2>
                </div>
                <div style="text-align:justify;  margin-left:10%; margin-right:10%">
                    Recent studies prove that diffusion models can generate high-quality samples, but their quality is
                    often highly reliant on sampling guidance techniques such as classifier guidance (CG) and
                    classifier-free guidance (CFG), which are inapplicable in unconditional generation or various
                    downstream tasks such as image restoration. In this paper, we propose a novel diffusion sampling
                    guidance, called <b>Perturbed-Attention Guidance (PAG)</b>, which improves sample quality across
                    both unconditional and conditional settings, achieving this without requiring further training or
                    the integration of external modules. PAG is designed to progressively enhance the structure of
                    synthesized samples throughout the denoising process by considering the self-attention mechanisms'
                    ability to capture structural information. It involves generating intermediate samples with degraded
                    structure by substituting selected self-attention maps in diffusion U-Net with an identity matrix,
                    and guiding the denoising process away from these degraded samples.
                </div>
            </div>

            <div class="row">
                <br><br>
                <div class="text-center col-md-offset-0">
                    <h2>
                        Guided Diffusion Results
                    </h2>
                    <p>← Hover over the image to compare results! (baseline vs ours)→</p>
                </div>
                <!-- <div class="text-center col-md-offset-0" style="margin-left: 10px;"> -->
                <!-- <div class="text-center col-md-offset-0">
                    <strong>
                        <h3>Unconditional Generation</h3>
                    </strong>
                    <img-comparison-slider style="width: 49%;" hover="hover">
                        <img slot="first" src="imgs/baseline/adm_uncond_baseline.png" width="100%" />
                        <img slot="second" src="imgs/ours/adm_uncond_ours.png" width="100%" />
                    </img-comparison-slider>
                    <strong>
                        <h3>Conditional Generation</h3>
                    </strong>
                    <img-comparison-slider style="width: 49%;" hover="hover" hover="hover">
                        <img slot="first" src="imgs/baseline/adm_cond_baseline0.png" width="100%" />
                        <img slot="second" src="imgs/ours/adm_cond_ours0.png" width="100%" />
                    </img-comparison-slider> -->
                <div class="col-md-6 text-center">
                    <strong>
                        <h3>Unconditional Generation</h3>
                    </strong>
                </div>
                <div class="col-md-6 text-center">
                    <strong>
                        <h3>Conditional Generation</h3>
                    </strong>
                </div>
                <img-comparison-slider style="width: 49%;" hover="hover" value="66">
                    <img slot="first" src="imgs/baseline/adm_uncond_baseline.jpg" width="100%" />
                    <img slot="second" src="imgs/ours/adm_uncond_ours.jpg" width="100%" />
                </img-comparison-slider>
                <img-comparison-slider style="width: 49%;" hover="hover">
                    <img slot="first" src="imgs/baseline/adm_cond_baseline0.jpg" width="100%" />
                    <img slot="second" src="imgs/ours/adm_cond_ours0.jpg" width="100%" />
                </img-comparison-slider>
            </div>


            <div class="row">
                <div class="text-center col-md-offset-0">
                    <h2>
                        Stable Diffusion Results
                    </h2>
                </div>
                <div class="text-center col-md-offset-0">
                    <strong>
                        <h3>Unconditional Generation</h3>
                    </strong>
                    <img-comparison-slider style="width: 49%;" hover="hover" value="66">
                        <img slot="first" src="imgs/baseline/sd_uncond_baseline_quarter.jpg" width="100%" />
                        <img slot="second" src="imgs/ours/sd_uncond_ours_quarter.jpg" width="100%" />
                    </img-comparison-slider>
                    <strong>
                        <h3>Conditional Generation (CFG vs CFG + Ours)</h3>
                    </strong>
                    <img-comparison-slider style="width: 75%;" hover="hover" value="66">
                        <img slot="first" src="imgs/baseline/sd_cfg.jpg" width="100%" />
                        <img slot="second" src="imgs/ours/sd_cfg_ours.jpg" width="100%" />
                    </img-comparison-slider>
                </div>
            </div>

            <div class="row">
                <div class="text-center col-md-offset-0">
                    <h2 style="margin-top: 60px; margin-bottom: 30px;">
                        Overall Framework
                    </h2>
                    <img src="img/architecture.png" style="width: 75%;" width="100%">
                    <div style="text-align:justify;  margin-left:10%; margin-right:10%">
                        <strong>Conceptual comparison between CFG and PAG.</strong> CFG employs
                        jointly trained unconditional model as the undesirable path, whereas PAG utilizes
                        perturbed self-attention for the same purpose. \(\mathbf{A}_t\) corresponds to the
                        self-attention map. In PAG, we perturb this by replacing with an
                        identity matrix \(\mathbf{I}\).
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="text-center col-md-offset-0">
                    <h2 style="margin-top: 45px; margin-bottom: 20px;">
                        Application to Downstream Tasks
                    </h2>

                    <strong>
                        <h3>Image Restoration (<a
                                href="https://github.com/LituRout/PSLD/tree/main?tab=readme-ov-file">PSLD</a>)
                        </h3>
                    </strong>
                    <img src="imgs/applications/psld_quarter_calibri.jpg" style="width: 75%;" width="100%">
                    <strong>
                        <h3>ControlNet with Empty Prompt (<a href="https://arxiv.org/abs/2302.05543">ControlNet</a>)
                        </h3>
                    </strong>
                    <img src="imgs/applications/controlnet_quarter.jpg" style="width: 75%; padding-right: 3%;" width="100%">
                </div>
            </div>

            <div class="row">
                <div>
                    <h3 style="margin-top: 60px;">
                        🧨Diffusers Pipelines and Community Implementation for GUI Interfaces
                    </h3>
                    <div>
                        Thanks to the exceptional efforts of @v0xie, @pamparamm and @multimodalart, you can now easily incorporate PAG into your custom pipelines or workflows.
                        <br>
                        <strong>🧨Diffusers pipeline for SD:</strong> <a href="https://huggingface.co/hyoungwoncho/sd_perturbed_attention_guidance">hyoungwoncho/sd_perturbed_attention_guidance</a>
                        <br>
                        <strong>🧨Diffusers pipeline for SDXL:</strong> <a href="https://huggingface.co/multimodalart/sdxl_perturbed_attention_guidance">multimodalart/sdxl_perturbed_attention_guidance</a>
                        <br>
                        <strong>SD WebUI (Automatic1111) extension:</strong> <a href="https://github.com/v0xie/sd-webui-incantations">v0xie/sd-webui-incantations</a>
                        <br>
                        <strong>ComfyUI node / SD WebUI Forge extension:</strong> <a href="https://github.com/pamparamm/sd-perturbed-attention">pamparamm/sd-perturbed-attention</a>
                        <br>
                        <br>
                        <i>Try a demo for SDXL <a href="https://huggingface.co/spaces/multimodalart/perturbed-attention-guidance-sdxl">here</a>!</i>
                    </div>
                </div>
            </div>

            <div class="row">
<!--                 <div class="col-md-offset-0">
                    <h3 style="margin-top: 45px;">
                        Citation
                    </h3>
                    <strong>If you find our work useful in your redreasearch, please cite our work as:</strong>
                    <div class="form-group col-md-10">
                        <pre>
@article{ahn2024selfrectifying,
    title={Self-Rectifying Diffusion Sampling with Perturbed-Attention Guidance},
    author={Donghoon Ahn and Hyoungwon Cho and Jaewon Min and Wooseok Jang and Jungwoo Kim and SeonHwa Kim and Hyun Hee Park and Kyong Hwan Jin and Seungryong Kim},
    journal={arXiv preprint arXiv:2403.17377},
    year={2024}
    }</pre>
                    </div>
                </div> -->

                <div class="col-md-offset-0">
                    <h3 style="margin-top: 30px;">
                        Acknowledgements
                    </h3>
                    <p class="text-justify">
                        <!-- We would like to thank Lior Yariv and Kai Zhang for helping us evaluate their methods, and Ricardo Martin-Brualla for helpful comments on our text. DV is supported by the National Science Foundation under Cooperative Agreement PHY-2019786 (an NSF AI Institute, <a href="http://iaifi.org">http://iaifi.org</a>) -->
                        <!-- <br> -->
                        The website template was borrowed from <a href="http://mgharbi.com/">Michaël Gharbi</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>
    </div>

    </div>
</body>

</html>
